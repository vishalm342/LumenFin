{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["import { clerkMiddleware, createRouteMatcher } from '@clerk/nextjs/server';\nimport { NextResponse } from 'next/server';\nimport type { NextRequest } from 'next/server';\n\n// Define public routes that don't require authentication\nconst isPublicRoute = createRouteMatcher([\n  '/',\n  '/sign-in(.*)',\n  '/sign-up(.*)',\n  '/api/webhooks(.*)', // Clerk webhooks\n]);\n\n// Define auth routes for redirect logic\nconst isAuthRoute = createRouteMatcher([\n  '/sign-in(.*)',\n  '/sign-up(.*)',\n]);\n\n// Define API routes that need authentication\nconst isProtectedApiRoute = createRouteMatcher([\n  '/api/chat(.*)',\n  '/api/ingest(.*)',\n]);\n\nexport default clerkMiddleware(async (auth, req: NextRequest) => {\n  // Domain validation for production to prevent cookie mismatch errors\n  const host = req.headers.get('host');\n  const url = new URL(req.url);\n  \n  // Only run authentication checks on your production domain\n  // This prevents cookie domain mismatch issues\n  const isProductionDomain = host && (\n    host.includes('vercel.app') || \n    host.includes('lumen-fin.vercel.app') ||\n    host === 'localhost:3000' // Allow local development\n  );\n\n  // Skip middleware for local development or non-production domains\n  if (!isProductionDomain && process.env.NODE_ENV === 'production') {\n    return NextResponse.next();\n  }\n\n  const { userId } = await auth();\n\n  // Redirect authenticated users away from auth pages\n  if (userId && isAuthRoute(req)) {\n    const dashboardUrl = new URL('/dashboard', req.url);\n    return NextResponse.redirect(dashboardUrl);\n  }\n\n  // Protect API routes that require authentication\n  if (isProtectedApiRoute(req)) {\n    if (!userId) {\n      return NextResponse.json(\n        { error: 'Unauthorized' },\n        { status: 401 }\n      );\n    }\n  }\n\n  // Protect all non-public routes\n  if (!isPublicRoute(req) && !userId) {\n    await auth.protect();\n  }\n\n  return NextResponse.next();\n});\n\nexport const config = {\n  matcher: [\n    /*\n     * Match all request paths except:\n     * - _next/static (static files)\n     * - _next/image (image optimization files)\n     * - favicon.ico, sitemap.xml, robots.txt (metadata files)\n     * - All files with extensions (.html, .css, .js, .jpg, etc.)\n     */\n    '/((?!_next/static|_next/image|favicon.ico|sitemap.xml|robots.txt|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp|ico|css|js|woff|woff2|ttf|eot)).*)',\n    // Always run for API routes\n    '/(api|trpc)(.*)',\n  ],\n};\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AAAA;;;AAGA,yDAAyD;AACzD,MAAM,gBAAgB,IAAA,wMAAkB,EAAC;IACvC;IACA;IACA;IACA;CACD;AAED,wCAAwC;AACxC,MAAM,cAAc,IAAA,wMAAkB,EAAC;IACrC;IACA;CACD;AAED,6CAA6C;AAC7C,MAAM,sBAAsB,IAAA,wMAAkB,EAAC;IAC7C;IACA;CACD;uCAEc,IAAA,wMAAe,EAAC,OAAO,MAAM;IAC1C,qEAAqE;IACrE,MAAM,OAAO,IAAI,OAAO,CAAC,GAAG,CAAC;IAC7B,MAAM,MAAM,IAAI,IAAI,IAAI,GAAG;IAE3B,2DAA2D;IAC3D,8CAA8C;IAC9C,MAAM,qBAAqB,QAAQ,CACjC,KAAK,QAAQ,CAAC,iBACd,KAAK,QAAQ,CAAC,2BACd,SAAS,iBAAiB,0BAA0B;IACtD;IAEA,kEAAkE;IAClE;;IAIA,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM;IAEzB,oDAAoD;IACpD,IAAI,UAAU,YAAY,MAAM;QAC9B,MAAM,eAAe,IAAI,IAAI,cAAc,IAAI,GAAG;QAClD,OAAO,gMAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,iDAAiD;IACjD,IAAI,oBAAoB,MAAM;QAC5B,IAAI,CAAC,QAAQ;YACX,OAAO,gMAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAe,GACxB;gBAAE,QAAQ;YAAI;QAElB;IACF;IAEA,gCAAgC;IAChC,IAAI,CAAC,cAAc,QAAQ,CAAC,QAAQ;QAClC,MAAM,KAAK,OAAO;IACpB;IAEA,OAAO,gMAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;;;;;;KAMC,GACD;QACA,4BAA4B;QAC5B;KACD;AACH"}}]
}